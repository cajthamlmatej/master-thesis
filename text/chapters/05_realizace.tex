\chapter{Realizace}

\begin{chapterabstract}
Tato kapitola popisuje jednotlivé fáze vývoje aplikace, která slouží k tvorbě interaktivních vzdělávacích materiálů. 
Nejprve je představen iterativní přístup, který umožnil průběžné testování a úpravy na základě zpětné vazby. 
Dále jsou rozebrány technické aspekty realizace -- od struktury klientské a serverové části, přes návrh a implementaci editoru a přehrávače, až po možnosti lokalizace, responzivity a zabezpečení. 
Kapitola se rovněž věnuje systémům rozšíření, multimédií a uživatelských interakcí, které tvoří základ pro škálovatelnost a budoucí rozvoj platformy. 
Nakonec kapitola ukazuje nasazení platformy společně s tím, co se pro platformu vytvořilo a co je možné s pomocí aplikace vytvořit za materiály.
\end{chapterabstract}

\section{Tvorba prototypu}


Během výběru samotného zadání této diplomové práce bylo nutné zvážit řadu faktorů, které by mohly ovlivnit realizovatelnost navrhovaného řešení. 
Jedním z klíčových aspektů byl potenciální problém s editorem, který by měl sloužit jako základ pro interaktivní tvorbu vzdělávacích materiálů. 
Jelikož existovalo riziko, že požadovanou funkcionalitu nebude možné efektivně implementovat v dostupných technologiích, bylo rozhodnuto o vytvoření prototypu. 
Tento prototyp měl za cíl ověřit proveditelnost hlavních funkcí a eliminovat případné zásadní překážky v rané fázi vývoje.

V rámci tvorby prototypu byly implementovány a testovány různé způsoby vykreslování obsahu, přičemž klíčovou otázkou bylo, zda bude vhodnější využít technologii HTML, SVG nebo Canvas.
Každý z těchto přístupů má své specifické výhody a nevýhody, které ovlivňují jak kvalitu zobrazení, tak výkon a možnosti interakce s uživatelem. 
Podrobnější rozbor těchto technologií je uveden v kapitole \ref{text:vykreslovani}, kde jsou jednotlivé přístupy porovnány z hlediska efektivity a použitelnosti v kontextu plánované platformy.

Při vývoji prototypu se objevily i obecné problémy související s implementací editoru -- respektive s jejich matematickou reprezentaci. 
Klíčovou výzvou se ukázaly být skupinové transformace a manipulace s prvky na plátně, zejména pokud jde o jejich pohyb a transformaci v rámci editačního prostoru.
Bylo nutné vyřešit, jakým způsobem budou tyto operace realizovány tak, aby editor zůstal uživatelsky přívětivý, efektivní a zároveň umožňoval pokročilé úpravy vytvořeného obsahu.

Na základě získaných poznatků byl prototyp úspěšně dokončen a posloužil jako důkaz, že zamýšlená funkcionalita může být realizována v rozumném stavu. 
Tento krok umožnil přejít k další fázi vývoje, která se zaměřuje na návrh a implementaci finální verze platformy s důrazem na rozšiřitelnost, komunitní podporu a snadnou použitelnost pro pedagogy i studenty.

Prototyp sloužil především k ověření základního konceptu a nebyl určen pro přímé použití v konečné implementaci platformy. 
Jeho účelem bylo rychlé experimentování s klíčovými funkcionalitami, bez důrazu na optimalizaci kódu či dlouhodobou udržitelnost. 
Po potvrzení, že zamýšlené principy mohou fungovat, bylo nutné přistoupit k přepsání prototypu do robustní a udržitelné podoby. 
Tento krok zahrnoval refaktorování kódu, zpřehlednění architektury a návrh struktury, která umožní snadnou údržbu i budoucí rozšíření funkcionalit. 
Přepis zároveň eliminoval technické dluhy vzniklé při rychlém vývoji.

% - behem vyberu samotneho zadani
% - velky risk problemu s editorem
% - implementovany ruzne zpusoby vykreslovani (viz kapitola \ref{text:vykreslovani}
% - obecny problemy s editorem a matematikou

\section{Metodika vývoje}\label{text:realizace/metodikaVyvoje}

Proces vývoje platformy pro tvorbu interaktivních výukových materiálů probíhal iterativním způsobem, což umožnilo průběžné testování a úpravy jednotlivých částí aplikace. 
Tento přístup se ukázal jako efektivní nejen při samotné implementaci, ale i při optimalizaci uživatelského prostředí na základě zpětné vazby od testerů.

Vývoj začal základním návrhem a analýzou požadavků, což bylo detailně popsáno v kapitolách \ref{text:navrh} a \ref{text:analyza}. 
Po definování architektury systému a stanovení klíčových funkcionalit byl zahájen samotný vývoj. 
Každá část aplikace byla pečlivě promyšlena před jejím naprogramováním, přičemž se důraz kladl na modularitu a možnost budoucího rozšíření.

Samotný vývoj probíhal iterativně. 
V každém cyklu bylo nejprve rozhodnuto, na které části aplikace se bude pracovat. 
Poté následovala detailní analýza a návrh této části, což umožnilo identifikovat možné komplikace ještě před samotnou implementací. 
Po naprogramování byla nová funkcionalita nasazena na dočasné testovací prostředí, kde probíhalo její testování různými uživateli. 
K testování byli zapojeni především kolegové a studenti (viz kapitola \ref{text:testovani}), jejichž zpětná vazba byla klíčová pro identifikaci problémů a návrh zlepšení.

Získané podněty byly zaznamenány a klasifikovány dle priority. 
Kritické chyby byly opraveny okamžitě, zatímco drobné úpravy a návrhy na zlepšení byly zařazeny do plánu budoucího vývoje. 
Tento přístup zajišťoval nejen stabilní vývoj systému, ale také jeho postupné vylepšování bez nutnosti výrazných zásahů do již implementovaných částí.

Během vývoje byl také kladen důraz na refaktoring kódu, což umožnilo udržovat čitelnost a efektivitu implementace. 
Starší části aplikace byly pravidelně přepisovány a optimalizovány s cílem zvýšit výkon a usnadnit další rozšíření systému.

Tento iterativní proces vývoje umožnil nejen průběžné zdokonalování aplikace, ale také pružně reagovat na nové požadavky a potřeby uživatelů. 
Díky tomuto přístupu bylo možné zajistit vysokou kvalitu finální verze platformy a její snadnou škálovatelnost pro budoucí rozšíření.

Vývoj platformy probíhal v prostředí verzovací služby GitLab, která sloužila jako hlavní nástroj pro správu kódu. 
Zároveň jsem využíval GitHub pro synchronizaci a zálohu repozitáře. 
Projekt byl veden jako monorepozitář, což umožnilo jednoduchou provázanost všech součástí systému, které spolu úzce souvisí. 
Tento přístup se ukázal jako výhodný pro počáteční vývoj, nicméně do budoucna by bylo vhodné jednotlivé části oddělit do samostatných repozitářů s jasně definovaným rozhraním.

Pro lepší orientaci v historii změn jsem používal semantické zprávy při commitech. 
Každá zpráva jasně popisuje, co se změnilo a v jaké části systému, což usnadňuje zpětné dohledávání konkrétních úprav. 
V rámci vývoje vzniklo XXX\todo{kolik?} samostatných balíčků změn (commit), které pokrývají vývoj nových funkcí, opravy chyb i refaktoring.

Plánování probíhalo mimo samotné verzovací nástroje, především prostřednictvím služby ClickUp. 
Tento nástroj sloužil ke správě úkolů, revizí a sledování pokroku ve vývoji. 
Pomáhal mi tak udržet přehled o jednotlivých krocích, přestože jsem pracoval většinou samostatně.


% - po zakladnim navrhu a analyze (viz kapitoly \ref{text:navrh} a \ref{text:analyza})
% - iterativni zpusob prace
%     - rozhodnout co dale programovat, analyza a navrh dane casti
%     - naprogramovat cast
%     - cast nasadit na docasnou produkci
%     - predat k testovani ruznymi kamarady (viz kapitola \ref{text:testovani})
%     - ulozit si feedback, issues
%     - opravit akutni chyby
% - prepisovani a vyuziti refactoring

\section{Klientská část}\label{text:realizace/klient}

Klientská část aplikace byla vyvinuta jako webová aplikace v souladu s návrhem z kapitoly \ref{text:navrh/klient}. 
Pro implementaci byl zvolen framework Vue spolu s nástrojem Vite, který umožňuje rychlý vývoj a stabilní správu závislostí.

Pro usnadnění tvorby požadovaných funkcionalit bylo využito několik knihoven, které zajišťují specifické potřeby aplikace. 
Mezi klíčové patří:

\begin{description}
    \item[floating-vue] Slouží k tvorbě vyskakovacích nápověd a kontextových menu.
    \item[moment] Umožňuje snadnou správu a manipulaci s daty a časovými údaji.
    \item[pinia] Poskytuje jednoduchý a efektivní způsob správy globálního stavu aplikace.
    \item[vue-router] Umožňuje vytvoření více virtuálních stránek v rámci jedné aplikace.
\end{description}

Dále byly použity i další knihovny, které přispívají k lepší modularitě a efektivitě vývoje.
O některých se budu dále zmiňovat v následujících kapitolách.


% - dle navrhu z analyzy \ref{text:navrh/klient} vytvorena webová aplikace
% - použit framewrok Vue s nástrojem Vite
% - použita řada knihoven pro zlehceni tvorby pozadovanych funkcionalit, napriklad:
%     - floating-vue pro tvorbu vyskakovacich tooltipů a menu
%     - moment pro jednoduchou správu datumu a času
%     - pinia pro jednoduchou správu data v globálních úložištích
%     - vue-router pro vytvoření více viruálních stránek
%     - a další

\subsection{Komponenty}

V souladu s analýzou v kapitole \ref{text:navrh/design/komponenty} byly vytvořeny všechny potřebné komponenty. 
Při jejich návrhu byl kladen důraz na znovupoužitelnost a udržitelnost kódu, přičemž značná část tvorby, inspirace a kódu pocházela z mé bakalářské práce~\cite{cajthaml_bp}.

První iterace vývoje se zaměřovala na základní implementaci klíčových prvků a ověření jejich funkčnosti. 
Hlavním cílem bylo zajistit, aby komponenty byly dobře udržovatelné a univerzálně použitelné v různých částech aplikace.

Tyto komponenty sloužili především pro webovou stránku a uvnitř editoru (viz kapitola \ref{text:realizace/editor}) se nepoužívají.

% - dle analýzy, kapitoly \ref{text:navrh/desgin/komponenty}, vytvořeny všechny komponenty
% - reusing kodu komponent, hodne inspirace z me bakalarske prace
% - obecne vytvareno prvni iterace 
% - cilem udrzitelne a pouzitelne komponenty

\subsection{Designový návrh}

První verze designu aplikace využívala komponenty a vizuální prvky, které byly navrženy s důrazem na rychlost vývoje a demonstraci funkčnosti. 
Tento přístup umožnil efektivní iteraci a testování uživatelského rozhraní v raných fázích vývoje.
Komponenty vycházely z designu vytvořeného v rámci mé bakalářské práce, což přineslo nejen vizuální kontinuitu, ale i možnost znovupoužití ověřeného kódu.

Postupem času bylo nutné design sjednotit a vytvořit konzistentní vizuální styl aplikace.
Namísto pevně daného návrhu jsem pracoval iterativně -- upravoval jsem komponenty, barvy a jejich proměnné, dokud celek nepůsobil harmonicky a esteticky vyváženě. 
Jako hlavní vizuální inspiraci jsem zvolil styl \texttt{glassmorphism}, který se vyznačuje průhlednými a rozmazanými prvky, čímž vytváří moderní a elegantní uživatelské rozhraní.
Tento styl je populární v moderním UI/UX designu a využívají ho například operační systémy macOS a Windows~11 nebo některé mobilní aplikace.
Součástí vizuální identity aplikace se stala fialová barva doplněná o gradienty, což přispívá k výraznému a zapamatovatelnému vzhledu.

Hlavním cílem bylo vytvořit jednoduchý, ale vizuálně přitažlivý design, který bude snadno přizpůsobitelný. 
Pro usnadnění budoucích úprav a možnou implementaci více barevných režimů byly ve stylování využity CSS proměnné.
Tento přístup umožňuje nejen jednoduché změny barevných schémat, ale i potenciální rozšíření designu o tmavý nebo kontrastní režim podle preferencí uživatele.

\subsection{Autentizace a autorizace}

Aplikace odděluje obsah určený pro veřejnost od částí přístupných pouze přihlášeným uživatelům. 
Všechny stránky s výjimkou přehrávače jsou dostupné jen po přihlášení. 
Autentizace probíhá pomocí tokenu, který se ukládá do localStorage. 
Pokud token vyprší, uživatel je automaticky přesměrován na přihlašovací obrazovku.

Autorizace se opírá o kontrolu přístupových práv při každém požadavku. 
Při každém požadavku v hlavičce \texttt{Authorization} s typem \texttt{Bearer} nalezne řetězec kódu JWT.
Kód obsahuje mimo jiné ID a jméno uživatele pro rychlejší přístup v aplikaci.

Pokud uživatel nemá oprávnění k požadované akci nebo zdroji, server vrací chybu. 
Klient správně reaguje na neúspěšné požadavky vyskakovacími okny, dialogy a jinými upozorněními.

Každý materiál má svého vlastníka, který k němu má vždy plný přístup. 
Vlastník materiálu může určit seznam spoluúčastníku, kteří mají přístup k editoru a přehrávání materiálu.

Materiály dále rozlišují viditelnost pomocí příznaku \texttt{visibility}. 
Pokud je nastavena hodnota \texttt{PUBLIC}, je materiál veřejně dostupný pro přehrávání přes přehrávač. 
V opačném případě, tedy při hodnotě \texttt{PRIVATE}, je přístup omezený pouze na vlastníka a případně přidané spolupracovníky.


% - všechny stránky až na přehrávač pouze pro přihlášené
% - token v localstorage
% - při expirování automaticky na login screen
% - autorizace: pokud nema pristup tak se hodi chyba
% - materiály mají majitele, který má přístu vždy
% - materiál může mít nastavenou viditelnost (VISIBILITY) na PRIVATE vs PUBLIC, kdy PUBLIC dovolí to zobrazovat všem (player)
% - materiál může mít přiřazené kolaborátory, kteří mají přístup k materiálu a přehrávání

% \subsection{Šablony}\todo{není implementované}

% - procházení

\subsection{Responzivita}\label{text:realizace/responzivita}


Všechny stránky aplikace jsou přizpůsobené pro různá zařízení, jak je podrobněji uvedeno v kapitole \ref{text:testovani}. 
Responzivita je zajištěna hlavně díky použití komponentového systému a systému gridu, přičemž konkrétně se využívá dvanácti sloupcové rozvržení. 
Rozdělení do sloupců je řízeno pomocí CSS tříd a breakpointů, přičemž nejčastěji se používají pouze tři základní — \texttt{sm}, \texttt{md} a všechny vyšší velikosti.

Většina rozvržení se přizpůsobuje právě přes tyto nastavené breakpointy. 
Dále se využívají pomocné třídy pro nastavení okrajů (\texttt{margin}), vnitřních okrajů (\texttt{padding}), flexibilního rozmístění prvků (\texttt{flex}) a rozestupů (\texttt{gap}). 
Tyto třídy také reagují na breakpointy, což umožňuje jemné doladění vzhledu jednotlivých částí rozhraní podle šířky obrazovky.

Výjimku tvoří editor, který má z pohledu responzivity specifické chování. 
Podrobnosti jeho řešení jsou popsány v kapitole \ref{text:realizace/editor}. 
V jeho případě bylo nutné upravit některé části individuálně, protože běžné techniky nebyly dostačující.

% - veskere stranky responzivni na urcite zarizeni, viz kapitola \ref{text:testovani}
% - responzivita diky komponentam, @media queries, celkove skoro žádná, až na editor, viz kapitola \ref{text:realizace/editor}
% - využití systému gridu, 12 sloupců, dělení pomocí columns, stejně jako komponenty, pomocí breakpointu
% - sloupce pomocí breakpointu, v zásadě jen "sm", "md" a vše vyšší
% - pomocné třídy pro padding, margin, flex, gapy a další, znovu breakpointy.


\subsection{Překlady}

Překlady v aplikaci probíhají pomocí vlastního systému, který vychází ze strukturovaného zápisu v jazyce JSON. 
Každý překlad je identifikován unikátním klíčem, například \texttt{editor.action.delete.tooltip}, a uložen ve stromové struktuře jako je vyobrazen v kódu \ref{code:zapisPrekladu}.
Tento přístup zajišťuje přehlednost a snadnou údržbu jednotlivých jazykových mutací.


\begin{listing}[ht!]
\caption{Ukázka zápisu překladů}\label{code:zapisPrekladu}
\begin{minted}{json}
{
  "editor": {
    "action": {
      "delete": {
        "tooltip": "Delete"
      }
    }
  }
}
\end{minted}
\end{listing}

K překladu textů v rozhraní se využívají direktivy \texttt{v-t} a funkce \texttt{\$t}, které dovolují překlad.
Taktéž umožňují vkládání proměnných přímo do přeložených řetězců. 
Proměnné jsou nahrazovány pomocí syntaxe jako \texttt{\%test\%}, což umožňuje dynamickou práci s obsahem bez nutnosti duplicitních překladů.

Aktuálně aplikace podporuje dva jazyky: češtinu a angličtinu. 
Překlady se ukládají i do zkrácené podoby v URL, což umožňuje přímé sdílení konkrétní jazykové verze rozhraní. 
Do budoucna lze očekávat problémy spojené se skloňováním, zejména v jazycích se složitou gramatikou, která vyžaduje flexibilitu podle kontextu. 
Tento aspekt zatím systém neřeší a může být řešen později například pomocí rozšíření stávající logiky.

% - vlastni system
% - pouziti klicu (napr. editor.title), zapis v JSON (\{editor: \{title: "..."\}\})
% - ulozeni zkratky v URL
% - pouziti direktiv a funkce \$t pro preklad, jde vkladat promenne
% - promenne nahrazovani pomoci \%test\%
% - v aplikaci prozaitm CS a EN
% - v budoucnu mozny problem se sklonovanim

\subsection{Optimalizace pro webové vyhledávače}

Klientská část platformy je postavena jako SPA pomocí frameworku Vue. 
Tento přístup přináší některé výhody z hlediska vývoje a uživatelského zážitku, ale současně komplikuje indexaci obsažených stránek vyhledávacími nástroji. 
Problém spočívá v tom, že většina obsahu se vykresluje až po načtení skriptů, což někteří roboti vyhledávačů nezohlední.

Tento problém byl vyřešen pomocí techniky \textit{prerendering}.
Při detekci specifického \textit{user-agenta} (typicky pro vyhledávací roboty) je požadavek přesměrován na službu \texttt{prerender}, která spustí virtuální prohlížeč, vykreslí cílovou stránku a vrátí její výsledný HTML výstup.
Výsledkem je obsah, který lze snadno indexovat bez ohledu na způsob zobrazení na straně klienta.

Z hlediska obsahu je pro SEO zásadní zejména přehrávač, který obsahuje samotné výukové materiály, a přihlašovací stránka. 
Prerendering je nasazen také pro hlavní stránku platformy, jak je popsáno v kapitole~\ref{text:realizace/hlavniStranka}. 
Samotné nasazení této služby je detailně popsáno v kapitole~\ref{text:realizace/nasazeni}.

Pro zlepšení optimalizace na straně klienta se používá knihovna \texttt{unhead}, která umožňuje dynamicky upravovat nadpisy stránek a další SEO metadata. 
V kombinaci s prerenderingem tak vzniká systém, který je pro vyhledávače čitelný a současně neomezuje funkčnost platformy. 
Stránky jsou navíc přístupné a plně responzivní, jak rozvádím v kapitole~\ref{text:realizace/responzivita}.

Alternativa k tomuto by byla použít vykreslování na serveru pomocí nějakého frameworku, třeba Nuxt.
Vzhledem k tomu, že stránky nejsou takovým velkým cílem SEO, se mi zdála tato možnost jako nevhodná a proto jsem ji nezvolil.

% \subsection{Optimalizace pro webové vyhledávače}

% - vue je SPA, problem s vykreslovanim pro vyhledavace
% - hlavni problem - vykresleni - reseno pomoci tzv. prerender
% - predkresleni stranky pro urcite lidi s danym user-agent
% - sluzba prerender, spousti virtualni prohlizec, vraci vykreslene HTML
% - pro klientskou cast je klicove jen prihlasovaci stranka a prehravac, ktery nese dalsi obsah
% - nasazeni reseno v sekci \ref{text:realizace/nasazeni}
% - v klientske casti reseni pomoci unhead nadpis stranky a dalsi seo
% - stranka je taktez pristupna, viz \ref{text:realizace/responzivita}
% - prerender se pouziva i na hlavni stranku viz sekce \ref{text:realizace/hlavniStranka}

\section{Serverová část}\label{text:realizace/server}

Serverová část aplikace byla implementována v souladu s návrhem popsaným v kapitole~\ref{text:navrh/server}. 
Hlavní jazykem byl TypeScript a vývoj probíhal s využitím frameworku Nest. 

Pro jednotlivé funkce byly použity následující balíčky:

\begin{description}
    \item[bcrypt] Kvalitní hashovací funkce, pro ochranu hesel.
    \item[class-validator] Pro validaci příchozích dat.
    \item[mjml] Pro formátování e-mailových šablon
    \item[puppeteer] Pro spouštění virtuálního prohlížeče pro generování náhledových obrázků a exporty materiálů.
    \item[nodemailer] Pro odesílání e-mailů.
    \item[socket.io] Pro správu WebSocketů, tedy real-time komunikace.
\end{description}

Nest framework je ve výchozím stavu postaven na knihovně Express a s tím jsem počítal i v návrhu aplikace.
V tomto projektu byl ale nakonec nahrazen za Fastify, protože Nest podporuje přepnutí serverového enginu nativně. 
Změna nevyžadovala větší úpravy a přinesla drobné výhody z hlediska výkonu a např. nahrávání souborů.

V porovnání s klientskou částí byla implementace serveru časově méně náročná.
Nejvíce úsilí vyžadovala klientská část, respektive vývoj editoru a přehrávače, jejichž návrh i funkcionalita byly složitější.

\subsection{Moduly}

Nest klade důraz na modularitu. Každá část aplikace je definována jako samostatný modul. V projektu byly vytvořeny tyto moduly:

\begin{description}
    \item[materials] -- správa výukových materiálů a jejich export.
    \item[auth] -- registrace, přihlašování a správa autentizace.
    \item[email] -- odesílání e-mailů a jejich šablonování.
    \item[events] -- real-time komunikace a kolaborace na materiálech.
    \item[media] -- správa mediálního obsahu uživatelů. 
    \item[preferences] správa uživatelského nastavení a personalizace.
    \item[users] -- uživatelské účty a jejich metadata.
\end{description}

Moduly \texttt{media}, \texttt{users}, \texttt{preferences} a \texttt{materials} využívají knihovnu Mongoose pro práci s databází MongoDB. 
Schémata jednotlivých entit jsou definována ve složce XXX\todo{složka}, v implementaci byly zjištěny různé nedostatky s původním návrhem a bylo nutné nějaké entity změnit.

\subsection{Autentizace a autorizace}

Autentizační logika využívá tzv. \emph{guardy}, které Nest nabízí jako mechanismus pro kontrolu přístupu.
Guardy se aktivují pomocí TS dekorátorů a lze jimi snadno řídit, které části systému vyžadují přihlášení a jakým způsobem. 
Použity byly různé varianty guardů -- pro běžné API volání, volitelnou autentizaci a také specifické guardy pro websocketové připojení.

Autorizace není centralizovaná, ale probíhá na úrovni jednotlivých endpointů. 
V každém případě se ověřuje, zda má uživatel přístup k danému materiálu -- buď je veřejný, nebo je uživatel jeho vlastníkem, případně účastníkem kolaborace.

\subsection{Přenos a výměna dat}

Komunikace mezi serverem a klientem probíhá pomocí formátu JSON.
Pro strukturovaný přenos dat byly vytvořeny DTO třídy, které definují, jaká data se mají mezi klientem a serverem přenášet. 
Tyto DTO se využívají jak v serverové, tak klientské části aplikace, což vyžadovalo častou synchronizaci během vývoje.

Validace těchto objektů probíhá pomocí knihovny \texttt{class-validator}, která umožňuje definovat validační pravidla přímo v kódu tříd. 
To přispívá ke konzistenci a zajišťuje, že na server se nikdy nedostanou nevalidní data přímo z klientské části.


% \section{Serverová část}\label{text:realizace/server}

% - serverová část aplikace byla vyvinuta v souladu s návrhem z kapitoly \ref{text:navrh/server}.
% - použití TS a Nest knihovny
% - další balíčky byly použity:
%     - bcrypt na hashovani hesel
%     - class-validator pro validovani prijmanych trid
%     - mjml pro formatovani emailu
%     - puppeteer na generaci nahledovych obrazku a export
% - misto express jsem nakonec pouzil fastify, protoze to za me knihovna resilo a nezdalo se to jako zadny problem, jen zlepseni

% - celkove server mene prace, nez jsem ze zacatku ocekaval, klientska cast, zejmena editor a prehravac byla nejvetsi programovaci cast

% \subsection{Moduly}

% - nest deli veci na moduly
% - vytvoril jsem tyto moduly:
%      - materials které spravují materiály a jejich export
%      - auth zajistuje prihlasovani a registraci
%      - email posilani emailu a jejich formatovani
%      - events pro kolaboraci a realtime komunikaci
%      - media pro spravu obsahu uzivatelů
%      - preferences pro nastaveni uzivatelů
%      - users sprava uzivatelu
%  - modul media, users, preferences, material obsahuji napojeni na mongoose, ODM pro mongo, schema jednotlivych entit ve finalnim zpracovani je mozne ve slozce XXXXXX

% \subsection{Autentizace a autorizace}

% - v nest pouzivam guardy (ktere se pak zapínají přes TS dekorátory)
% - guardů existuje mnoho, existuji varianty na povinne prihlaseni, nepovinne a prihlaseni do WS
% - autorizaci si řeší každý endpoint sam, kontroluje se, zda ma uživatel přístup k materiálu (je veřejný, je majitelem, je účastníkem)

% \subsection{Přenos a výměna dat}

% - probiha pomoci JSON
% - vytvořeny DTO, viz slozka YYYYYY, jsou stejne pro server i klient, casta synchronizace pri vyvoji
% - pouzivam class-validator pro validaci techto entit

\section{Editor a přehrávač}\label{text:realizace/editor}

Editor a přehrávač tvoří jádro klientské části aplikace. 
Jde o nejzásadnější komponentu, která přímo ovlivňuje práci s materiálem. 
Obě části sdílí podobnou strukturu kódu a pracují s jednotným datovým modelem -- takzvanými bloky. 
Každá instance editoru nebo přehrávače je vždy svázána s jedním konkrétním snímkem. 
Vykreslování probíhá nezávisle na frameworku Vue a bylo nutné vytvořit vlastní mechanismus překreslování.

Pro vykreslování využívám čisté DOM v JS prohlížeče.
Každá komponenta editoru či přehrávače má na starosti práci se svým prvkem stránky a to včetně překreslování při změně dat.

\subsection{Materiál}

Materiál představuje základní datovou jednotku editoru.
Skládá se z několika snímků a nese název, který slouží pro identifikaci. 
Snímek ukládá informace o velikosti plátna či barvě pozadí.
Kromě obsahu materiálu jsou součástí také informace o způsobu jeho zobrazování, časovač, viditelnost či přístupnost pro jednotlivé uživatele.

\subsection{Bloky}

Bloky reprezentují uživatelem vytvořená data, jako jsou texty, obrázky nebo jiné vizuální prvky. 

Každý blok obsahuje základní sadu vlastností: 

\begin{itemize}
	\item Pozici na snímku
	\item Velikost
	\item Otočení
	\item Průhlednost
	\item Skupina
	\item Z-index
	\item Informace o interaktivitě
\end{itemize}

Z této základní třídy vycházejí všechny konkrétní typy bloků, které rozšiřují funkčnost podle svého určení.
Každý blok se řadí do konkrétnější třídy podle toho, zda je určen pro přehrávač či editor.
Podle toho mají konkrétní funkcionality.

\subsubsection{Serializace a deserializace}

Editor má vytvořenou metodu \texttt{serialize}, která slouží k převodu stavu editoru do JSON formátu.

Každý blok taktéž disponuje metodou \texttt{serialize}, která slouží k převodu interního stavu bloku do JSON formátu. 
Výstup slouží k ukládání a pozdějšímu načtení dat. 
Děděné třídy anotují vlastnosti, které se mají do serializace zahrnout, pomocí TypeScript dekorátorů. 
Tato metoda zajišťuje, že se ukládají pouze relevantní informace a celý proces zůstává přehledný a konzistentní.

Pro proces deserializace jsou vytvořeny pro každý jednotlivý blok třída, která slouží k jeho deserializaci a převedení do podoby instance určené pro editor či přehrávač.

Pro deserializaci (a práci v celém editoru či přehrávači) je vytvořená třída \texttt{BlockRegistry}, do které si jde zaregistrovat právě soubor třídy pro editor, třídy pro přehrávač a deserializer. 

\subsubsection{Události}

Bloky mohou reagovat na různé události, jako je vykreslení na stránku, výběr uživatelem, pohyb, změna velikosti a další interakce.
Tyto události jsou implementovány jako metody s TypeScript dekorátory, které umožňují snadné napojení na jakoukoliv metodu a to i klidně vícekrát.
Díky tomu mohou jednotlivé bloky flexibilně reagovat na dění v editoru i přehrávači.

\subsection{Editor}

Editor staví základní funkcionalitu bloků o nástroje určené pro jejich úpravu. 
Nabízí bohaté možnosti nastavení, rozhraní pro interakci i další API, které využívají jak bloky, tak nadřazené části aplikace.
Editor je navržen jako rozšiřitelný a jednotlivé bloky se mohou připojovat na jeho události.

\subsubsection{Transformace}

Editor umožňuje s bloky manipulovat pomocí několika nástrojů. 
Bloky lze označovat jednotlivě nebo hromadně, měnit jejich velikost, přesouvat je po ploše nebo je otáčet. 
Způsob transformace lze přizpůsobit -- podle nastavení může být například změna velikosti sdílená jako jeden velký objekt či jednotlivě.

Každý blok má možnost zakázat některé operace, například znemožnit otočení nebo změnu velikosti. 
Bloky lze také uzamknout, což znemožní jejich výběr při tažení výběrovým rámečkem (select boxem). 
Tato granularita nastavení zajišťuje přesné chování bloku podle kontextu použití.

% \section{Editor a přehrávač}\label{text:realizace/editor}

% - součást klientské části
% - nejdůležitější část
% - samostatné vykreslování mimo Vue, vlastní řešení překreslování
% - oboje podobný kód, pracují s tzv. bloky
% - vždy instance pro jednu stránku

% \subsection{Materiál}

% - obsahuje několik stránek
% - jméno
% - nastavení zobrazování

% \subsection{Bloky}

% - reprezentuje uživatelem vytvořená data
% - např. text či obrázky
% - každý blok obsahuje základní data: pozici, velikost, otočení, průhlednost, skupinu, z-index a interaktivitu
% - z této třídy poté ostatní dědí

% \subsubsection{Serializace}

% - slouží k převedení bloku do JSON podoby, která se poté ukládá
% - každý blok má serialize metodu, která slouží pro nalezení věcí, které se mají uložit a uložení jich
% - vlastnosti v děděných třídách se anotují pomocí TS dekorátorů, které metoda čte

% \subsubsection{Události}
% - jednotlivé bloky dědící z hlavní třídy mohou používat eventy
% - tím se lze navázat například na to, kdy je blok vykreslen na stránku, vybrán v editoru, posunován a mnoho dalšího
% - pro toto používám TS dekorátory metod

% \subsection{Editor}

% - specifické věci pro editor následují
% - editor má dost nastavení a další API
% - editor má události, na které se může každý blok vázat

% \subsubsection{Transformace}

% - bloky je možné:
%   - označovat (i více)
%   - zvětšovat
%   - posouvat
%   - otáčet

% - dle nastavení mohou být operace zvětšování nastaveny na kolaborativní či jednotlivé transformace

% - každý blok může jednotlivé operace vypnout

% - tažení (select box)
% - blok může být uzamknut a není možné ho vybrat tažením

\subsubsection{Akce}

Editor podporuje množství kontextových akcí, které se dynamicky mění podle aktuálního výběru. 
Tyto akce jsou dostupné buď v kontextovém menu (pravým kliknutím), nebo jako globální nástroj nad označenými bloky. 
Rozhraní pro akce se aktualizuje podle typu a množství označených bloků.

Mezi běžné akce patří seskupování bloků, jejich oddělování, přesunutí do jiného snímku, kopírování nebo mazání. 
Každá akce může mít definované klávesové zkratky, které umožňují efektivní práci i bez použití myši. 
Základní sada akcí je definována jako rozšiřitelná a jednotlivé akce lze registrovat externě.

\subsubsection{Vlastnosti bloků}

Editor zobrazuje panel vlastností, který se mění v závislosti na výběru. 
Při výběru více bloků se zobrazuje pouze podmnožina vlastností, které mají bloky společné a které lze hromadně upravit. 
Například u více vybraných bloků tvaru je možné současně měnit průhlednost či barvu ale i tvar.

Systém vlastností je navržen jako flexibilní API, které umožňuje definovat různé typy vstupů včetně posuvníků, barevných výběrů, zaškrtávacích polí a dalších. 
Editor podporuje také přímé tahání u nadpisu vlastnosti pro efektivnější změnu hodnoty vlastnosti.

Panel vlastností se může dynamicky měnit -- zmenšovat, skrývat nebo naopak rozšiřovat podle obsahu a typu vybraných bloků. 
Díky tomu zůstává uživatelské rozhraní přehledné i při práci s komplexními scénami.


% \subsubsection{Akce}

% - kontextove (pravy klik)
% - select (nad označenými prvky)
% - updatuji se dle označenych prvků
% - např. seskupení, přesunutí do plátna, kopírování
% - každá akce může mít klávesové zkratky, které dovolují jednoduché akce s editorem

% - jaké byly implementované?\todo{todo}

% \subsubsection{Vlastnosti bloků}

% - podle vybraných bloků
% - stejné možné vlastnosti, které to podporují se mohou spojit do jedné
% - možnost upravovat skoro jakákoliv data
% - velké api agregací a typů vlastností
% - možnost změny pomocí dragování
% - panel se zdá zvětšovat i skrývat


\subsubsection{Historie}

Editor průběžně zaznamenává veškeré důležité události, které se v jeho prostředí odehrávají. 
Při každé takové události se uloží celý stav editoru, což umožňuje následnou práci s historií změn. 
Uživatel se může pohybovat zpět nebo vpřed pomocí klasických operací typu \enquote{Zpět} a \enquote{Znovu}. Tento mechanismus využívá princip podobný návrhovému vzoru \emph{memento}~\todo{citace}, kdy se každá změna zaznamenává jako izolovaný snímek stavu editoru.

Velikost uchovávané historie je konfigurovatelná podle preferencí uživatele, aby bylo možné optimalizovat výkon při práci s rozsáhlými materiály. 
Kromě standardních událostí, které editor sám rozpoznává, existuje i speciální událost.
Tuto událost mohou vyvolat jiné části systému, například při importu dat nebo externích úpravách, na které není možné se v editoru běžně zaregistrovat.

\subsubsection{Schránka}

Součástí editoru je vlastní implementace schránky, která umožňuje uživatelům kopírovat a vkládat bloky. 
Tyto operace fungují napříč stránkami jednoho otevřeného dokumentu, ale také mezi různými materiály, které má uživatel současně otevřené. 
Schránka zachovává obsah mezi jednotlivými návštěvami editoru, což zajišťuje plynulost práce i při opuštění nebo obnově relace.

Kopírování respektuje vnitřní strukturu bloků a umožňuje jejich vkládání bez ztráty informací. 
To je užitečné zejména při vytváření šablon, duplikování opakujících se částí obsahu nebo přenášení obsahu mezi různými snímky.

\subsubsection{Nastavení}

Uživatel má možnost upravit široké spektrum nastavení, která ovlivňují chování editoru. 
Kromě základních preferencí lze definovat například maximální velikost historie změn, počet kroků při otáčení objektů nebo způsob provádění transformací.

Editor nabízí několik režimů transformace a různé možnosti chování při zarovnávání či počet bodů přichytávání při rotaci objektů. 
Díky těmto volbám si může každý uživatel přizpůsobit prostředí svým potřebám -- ať už preferuje jakoukoliv práci.

Všechna nastavení se ukládají do profilu uživatele, takže při každém otevření editoru jsou znovu automaticky načtena.


% \subsubsection{Historie}

% - zaregistrovává se k různým událostem, které se dějí v editoru
% - při každé události si uloží stav celého editoru
% - pomocí akcí zpět a dopředu se lze v této historii hýbat
% - omezení velikosti historie dle preferencí uživatele
% - samotné aplikování a ukládání stavu podobné jako v návrhovém vzoru memento\cite{abbc}
% - existuje speciální událost, kterou mohou volat ostatní části systému, na které se v editoru nedá registrovat

% \subsubsection{Schránka}

% - dovoluje kopírovat bloky a vkládat je pomocí operací
% - je mozne kopirovat skrz stránky (otevrené i najednou)
% - taktéž je možné kopírovat skrz snímky jednoho materiálu
% - ukládá se skrz poslední návštěvu

% \subsubsection{Nastavení}

% - nastavení anebo preference
% - uživatel si nastaví jak chce, aby s ním editor komunikoval
% - muže nastavit např. zmíněnou velikost historie
% - nebo nastavit například počet snapnutí otáčení, způsob transformace a další

\subsection{Přehrávač}

Přehrávač sdílí mnoho společných rysů s editorem, avšak přináší několik klíčových odlišností. 
Stejně jako editor využívá systém bloků a vlastní způsob vykreslování, ale je navržen primárně pro konzumaci a interakci s výukovým materiálem, nikoliv jeho úpravu.

Zásadním rozšířením přehrávače oproti editoru je přidání režimu kreslení. 
Tento režim umožňuje uživateli vybírat barvu, nastavovat tloušťku čáry, úroveň průhlednosti nebo aktivovat stabilizaci tahu. 
K dispozici jsou i akce jako mazání jednotlivých tahů, skrytí či smazání celé kresby.

Uživatelské rozhraní přehrávače umožňuje přepínat mezi snímky buď pomocí tlačítek, nebo kliknutím na samotné plátno.
Interakce se snímky tak zůstává plynulá a intuitivní. 
Samotné bloky mohou reagovat na uživatelské vstupy díky systému interaktivity a speciálním blokům z rozšíření.

\subsection{Interaktivita}

Každý blok může mít přidělenu neomezeně mnoho instancí interaktivit, která určují jeho chování při specifických událostech. 
Každá interaktivita definuje událost spuštění interakce a podmínku spuštění.
Všechny další vlastnosti se mění dle vybraných možností.

Události spuštění:
\begin{description}
  \item[CLICK] Aktivace po kliknutí na blok.
  \item[HOVER START] Aktivace při najetí kurzorem.
  \item[HOVER END] Aktivace při odjetí kurzoru.
  \item[SLIDE LOAD] Aktivace při načtení snímku, bez ohledu na blok.
  \item[TIMER] Spuštění po určitém čase, jednorázově nebo opakovaně.
\end{description}


\begin{figure}[ht!]
    \centering
    \includegraphics[width=0.8\textwidth]{media/05_realizace/interaktivita.png}
    \caption{Ukázka interaktivity na bloku v Editoru}
    \label{fig:interaktivita}
\end{figure}


Podmínky spuštění:
\begin{description}
  \item[ALWAYS] Akce se spustí vždy.
  \item[TIME PASSED] Po uplynutí určitého času od načtení snímku nebo zapnutí celého materiálu.
  \item[VARIABLE] Na základě hodnoty specifické proměnné.
\end{description}

Interaktivita může obsahovat libovolné množství akcí. Mezi základní akce patří:

\begin{description}
  \item[CHANGE PROPERTY] Změní zaregistrovanou vlastnost bloku.
  \item[RESET PROPERTY] Vrátí vlastnost do původního stavu.
  \item[CHANGE SLIDE] Přejde na jiný snímek – konkrétní, relativní, nebo náhodný.
  \item[CHANGE VARIABLE] Upraví hodnotu proměnné.
  \item[OPEN LINK] Otevře externí odkaz.
\end{description}

Akce se mohou vztahovat na konkrétní bloky, všechny bloky na snímku, nebo aktuální blok. 
Systém podporuje interpolaci pro plynulé přechody hodnot a možnost zadávat relativní změny.
Vlastnosti, které lze měnit, si každý blok definuje samostatně pomocí rozhraní v kódu (viz kód \ref{code:zapisVlastnostiEditor} a \ref{code:zapisVlastnostiPrehravac}).

Ukázka nastavené interaktivity na bloku lze vidět na obrázku \ref{fig:interaktivita}.

\begin{listing}[ht!]
\caption[Ukázka zápisu registrace vlastnosti bloku tvaru pro editor]{Ukázka zápisu registrace vlastnosti bloku tvaru pro editor, \textit{kód zkrácen a modifikován pro přehlednost}}\label{code:zapisVlastnostiEditor}
\begin{minted}{javascript}
public override getInteractivityProperties() {
  return [
    ...super.getInteractivityProperties(),
    {
      label: "Color",
      animate: true,
      relative: false
    }
  ];
}
\end{minted}
\end{listing}



\begin{listing}[ht!]
\caption[Ukázka zápisu registrace vlastnosti bloku tvaru pro přehrávač]{Ukázka zápisu registrace vlastnosti bloku tvaru pro přehrávač, \textit{kód zkrácen a modifikován pro přehlednost}}\label{code:zapisVlastnostiPrehravac}
\begin{minted}{javascript}
public override getInteractivityProperties() {
  return [
    ...super.getInteractivityProperties(),
    {
      label: "Color",
      change: (value: string, relative: boolean, ...) => {
        // Validace
        if (animate) {
          // Interpolace podle dalších předaných hodnot.
          // Často využívána funkce requestAnimationFrame
          //    pro plynulé volání změn.
        } else {
          this.color = value;
          this.synchronize();
        }
      },
      // Pro reset vlastnosti
      getBaseValue: () => this.blockBaseValues.color
    }
  ]
}
\end{minted}
\end{listing}

Tyto interaktivity jsou zpracovávány přímo přehrávačem a mohou být snadno laděny pomocí ladícího režimu, který zobrazuje stav proměnných. 
Pro jednodušší práci s interaktivitou byl vytvořen i speciální blok -- a to interaktivní oblast.
Tento blok umožňuje definovat akce, které nejsou navázané na žádný konkrétní vizuální prvek, ale slouží jako neviditelný spouštěč událostí.


% \subsection{Přehrávač}

% - podobné fungování jako editor
% - vlastní bloky, vlastní vykreslování
% - jiné módy => přidáno kreslení
% - kreslení: dovoluje vyber barvy, velikost čáry, průhlednost, stabilizace, akce mazání, smazání všeho,
% - UI dovoluje přepínání snímku tlačítky či mačkání na "plátno"
% - interakce s bloky pomocí interaktivity a speciálních bloků rozšíření

% \subsection{Interaktivita}

% - každému bloku lze přidat interaktivity
% - ty určují jak se blok bude chovat v různých situacích
% - každá interaktivita má povinně určenou událost a podmínku volání
% - události:
%   - CLICK, při kliknutí na daný blok
%   - HOVER START, při najetí na daný blok
%   - HOVER END, při ukončení najetí (odjetí) z daného bloku
%   - SLIDE LOAD, při načtení snímku (bez závislosti na bloku)
%   - TIMER, který dovoluje spuštění po nějaké době či opakovaně
% - podmínky:
%   - ALWAYS, akce se provedou vždy
%   - TIME PASSED, po nějaké době od otevření materiálu či konkrétního snímku, na kterém je blok (tato interakce)
%   - VARIABLE, po tom, zda se hodnota nějaké podmínky rovná či nerovná zadané hodnotě
% - poté může interaktivita obsahovat neomezeně mnoho akcí
% - akce:
%   - CHANGE PROPERTY, která dovolí změnit zaregistrované vlastnosti bloku
%   - RESET PROPERTY, která dovolí resetovat zaregistrované vlastnosti bloku do původního stavu
%   - ^ u nich jde vybrat jaké bloky (všechny na snímku, aktuální či konkrétní) se budou změny aplikovat 
%   - ^ taky je možné použít interpolace pro přechod a či relativní hodnoty, které upravují aktuální stav
%   - každý blok si registruje tyto vlastnosti sám, viz kód \ref{code:zapisVlastnosti}
%   - CHANGE SLIDE, změna snímku, podle indexu či relativní (+, -, náhodný, NEXT, PREVIOUS, FIRST, LAST)
%   - CHANGE VARIABLE, dovolí změnit hodnotu proměnné na jinou 
%   - OPEN LINK, dovolí otevřit jinou stránku
% - tyto interaktivity se poté zpracovávají v přehrávači při daných událostech
% - proměnné si lze zobrazit v přehrávači v tzv. debugovacím módu
% - pouze pro interaktivitu vytvořen speciální blok - interaktivní oblast.

\subsection{Multimédia}

Součástí editoru je možnost vkládat multimediální obsah, zejména obrázky a animované gify.
Uživatel má k dispozici dvě základní cesty: buď využije integrované knihovny, nebo nahraje vlastní soubory. 
V obou případech lze multimédia vložit přímo do výukového materiálu jednoduchým kliknutím.

Pro vyhledávání fotografií slouží napojení na fotobanku Pexels. 
Uživatel může zadat libovolný dotaz a zároveň má možnost vybírat z aktuálně populárních obrázků. 
U animovaných gifů je použita služba Tenor, která je přístupná skrze Google API. 
Vyhledávání zde probíhá na základě klíčových slov nebo výběrem z předdefinovaných kategorií.

Nahrané soubory se ukládají do uživatelova účtu a lze je použít opakovaně napříč různými výukovými materiály.
V případě většího množství nahraných souborů je procházení optimalizováno pomocí tzv. lazy-loading, což znamená, že se obsah načítá postupně podle potřeby, a nezatěžuje tak prohlížeč ani připojení zbytečnými daty.

Kromě fotobanky a gifů má uživatel možnost vložit jakýkoli externí odkaz na obrázek.
Tento způsob je vhodný zejména tehdy, pokud uživatel nechce daný obrázek ukládat do systému, ale chce jej pouze referencovat. 
O způsobu vložení externího odkazu a respektive o bloku obrázku pojednává detailně sekce \ref{text:realizace/vytvoreneBloky}.

% \subsection{Multimédia}

% - vytvořené z fotobank/gifbank
% - uživatel má možnost nahrát vlastní obrázky
% - vlastní obrázky lze používat vícekrát v různých materiálech
% - vlastní procházení všech variant pomocí lazy-loading
% - fotobanka: Pexels, kde jde vyhledávat \& "populární obrázky"
% - gifová banka: Tenor v Google APIs, vyhledávání pomocí kategorií a co uživatel zadá
% - po kliku se dané multimédium přidá do materiálu
% - uživatel může zadat jakýkoliv odkaz do bloku obrázku viz sekce \ref{text:realizace/vytvoreneBloky}
\subsection{Kolaborace}

Možnost víceuživatelské kolaborace nad jedním výukovým materiálem je jedním ze stěžejních rysů celé platformy.
Bez její existence by bylo možné pracovat na materiálu pouze z jednoho zařízení, případně by bylo nutné implementovat zamykání souboru a koordinovat přístupy mezi jednotlivými uživateli. 
To by významně omezilo plynulou spolupráci a editaci v reálném čase.

Cílem bylo umožnit současnou úpravu jednoho materiálu více uživateli. 
Typickým příkladem je práce z více zařízení jedním uživatelem nebo kooperace více učitelů. 
Tím, že je kolaborace zajištěna přímo na úrovni serveru (viz kapitola~\ref{text:realizace/server}), není nutné řešit tradiční formy zamykání dokumentu.

Při zahájení editace materiálu se na serveru příslušný materiál označí jako \enquote{aktivní} a jeho obsah je načten do paměti. 
Od tohoto momentu není změna ihned uložena do databáze, ale uchovává se dočasně a průběžně se ukládá s využitím techniky \textit{debounce} -- tedy až ve chvíli, kdy se tři sekundy nic nemění. 
V případě dlouhodobé editace se změny ukládají nejpozději po třiceti sekundách.

Editace probíhá ve speciální místnosti (\textit{material editor room}), do které se mohou připojit všichni uživatelé s přístupem k danému materiálu. 
Server v této místnosti sleduje aktivitu jednotlivých účastníků -- na kterém snímku se nacházejí, jaké bloky mají označené, jejich jméno a barvu. 
Pouze majitel daného materiálu může nastavit, kteří uživatelé mají k editaci materiálu přístup.

Složité by bylo synchronizovat úpravy jednoho bloku více lidmi současně.
Z tohoto důvodu je na úrovni klienta i serveru zaveden mechanismus pro zamykání jednotlivých bloků.
V jeden moment může daný blok upravovat pouze jeden uživatel.

Při každé změně -- ať už jde o přepnutí snímku, označení bloku nebo jeho úpravu -- klient informuje server. 
Server změnu přepošle všem ostatním připojeným účastníkům, čímž je zajištěna konzistence mezi jednotlivými instancemi editoru.
V materiálu u klienta je v UI vidět, kdo je k materiálu připojen, jak se jmenuje a na jakém snímku se aktuálně nachází.
Na daném snímku se poté vykresluje speciální obdélník okolo bloků, které má označené (a které tedy nelze označovat).

Server neplní pouze roli zprostředkovatele komunikace. 
Zajišťuje také generování náhledových snímků, správu práv a samotné ukládání dat.
Náhledové snímky se generují pomocí knihovny \texttt{puppeteer} na straně serveru. 
Server v takovém případě spustí virtuální prohlížeč a kontaktuje speciální stránku na klientovi, která po ověření vykreslí požadovaný snímek bez uživatelského rozhraní, a prohlížeč tuto stránku zachytí. 
Tento vykreslený náhled je poté odeslán zpět a uložen do databáze. 
Výsledkem je velmi přesná vizualizace reálného vzhledu snímku bez závislosti na rozšířeních nebo výkonu zařízení klienta.
Stejně jako u ukládání probíhá generování náhledů pomocí \textit{debounce} se stejnými časovými limity.

Nad rámec synchronizace samotného obsahu se mezi klienty přenášejí také další informace o materiálu -- jeho název, nastavení sdílení nebo vlastnosti přehrávání.
Synchronizují se i případná rozšíření a další metadata, čímž se zajišťuje, že všichni účastníci mají vždy aktuální stav.

% \subsection{Kolaborace}

% - práce na jednom materiálu by bez tohoto byla možná jen na jednom počítači
% - pokud by neexistovala, bylo by nutné soubor uzamykat a nebyla by možnost spolupracovat v jeden moment
% - zejména serverová věc, implementace v kapitole \ref{text:realizace/server}

% - hlavním cilem bylo to, aby v jeden moment mohl upravovat jeden material vice lidi, pr. jeden clovek z vice zarizeni
% - neni nutne resit zamykani souboru

% - pokud nekdo zacne editovat material, na serveru se takto material oznaci a misto klasickeho ulozeni v db je ulozen v pameti a casto ukladan
% - existuje mistnost (room) pro editaci konkretniho materialu, do ktere se mohou připojit lidi, kteri maji pristup do materialu
% - v tomto modu si server pamatuje o kazdem ucastnikovi: na jakem snimku se nachazi, jake bloky ma oznaceny, jmeno a barvu

% - klient i server vytvari system zamykani jednotlivych bloku na snimku, protoze jejich synchronizace by byla slozita. v jeden moment tedy muze mit jeden blok oznacen jen jeden clovek
% - pri zmene (bloku, oznaceni bloků, snimku) klient oznamuje zmenu serveru, ten ji preposila dalsim ucastniku
% - v klientske casti je videt kdo je k materialu pripojen, kdo je na jakem slidu a jake bloky ma kdo oznacene
% - server se mimo rizeni komunikace a povolovani toho, co kdo muze, stara i o dalsi veci, jako je napriklad generovani nahledovych snimku ci ukladani
% - ukladani probiha 1x za 3 sekundy prave tehdy, pokud nekdo neco zmenit pomoci tzv. debounce, tedy ulozi se az po 3 sekundach prestane prace (zmena bloku), pripadne po 30 i se zmenami
% - generovani nahledovych snimku jsem resil tim zpusobem, ze misto generace na klientovi (zavislost na rozsirenich, pomale, rusive pro klienta) se generuji na serveru pomoci virtualniho prohlizece (knihovny puppeteer), tim, ze server kontaktuje specialni stranku na klienta, kde se verifikuje specialnim kodem, a bez UI vykresli v prehravaci dany snimek (ci snimky), ktere se pote odesilaji klientům a ukládají se do db
% - generovani na serveru taktez znamena velmi presne zobrazeni toho, co tam realne je
% - generovani je taktez tvoreno pomoci debounce se stejnymi intervaly jako ukladani
% - mezi klienty se synchronizují taktéž dalši data o materiálu (např. jméno, nastavení sdílení a přehrávání) a například rozšíření

\subsection{Importování a exportování}

Přestože jsou výukové materiály na platformě koncipovány jako interaktivní, existují případy, kdy je potřeba je převést do statické podoby.
Typicky jde například o tisk, archivaci nebo tvorbu plakátu. 
Zároveň je důležité, aby měl uživatel možnost uchovávat lokální zálohy materiálů, a tím zvýšit bezpečnost dat mimo samotný server.

Systém proto podporuje jak import, tak export materiálů. 
Architektura je rozdělena mezi klienta a server. Import zajišťuje klientská část, která ze zadaného vstupu vytvoří nový materiál včetně odpovídajících bloků. 
Export naopak probíhá na serveru.

Při exportu odešle klient požadavek na konkrétní formát, aktuálně podporované jsou \texttt{JSON} a \texttt{PDF}. 
Export do JSON vrací kompletní strukturu materiálu, respektive jednotlivých snímků, včetně všech vlastností. 
Tento formát je vhodný pro zálohování nebo pozdější import. 
Export do PDF funguje tak, že server pomocí nástroje \texttt{puppeteer} vykreslí každý snímek zvlášť jako náhled -- obdobně jako v případě kolaborace. 
Výsledkem je soubor obsahující jednotlivé stránky, které reflektují vzhled snímků tak, jak je vidí uživatel.
Jelikož mohou mít jednotlivé snímky odlišné rozměry, je nezbytné generovat je po jednom a teprve následně spojit do jednoho PDF dokumentu.

Import podporuje klient ze dvou formátů: \texttt{JSON} a \texttt{Markdown}. 
Při importu JSON dojde ke znovuvytvoření materiálu přesně podle předchozí struktury. 
Markdown je zpracován pomocí knihovny \texttt{marked}, která na klientovi vrací stromovou reprezentaci dokumentu. 
Klient následně přečte jednotlivé nadpisy a obsahové bloky mezi nimi a rozdělí je do odpovídajících snímků. 
První nadpis se použije jako název materiálu a titulní strana.

Markdown import podporuje běžné textové struktury jako nadpisy, tučný a kurzívní text, odkazy nebo seznamy. 
Díky tomu je možné rychle vytvořit základní kostru prezentace bez nutnosti ručního zadávání každého bloku.

% \subsection{Importování a exportování}

% - materialy jsou sice interaktivni, ale nekdo si naprikald muze chtit material vytisknout, nebo v tom opravdu delat treba nejaky plakát
% - system musi dovolovat lokalni zalohy pro bezpecnost

% - implementovan system, kdy importovani dela klient, ktery vytvori material s danymi bloky
% - export dela server

% - exportovani: na server se posle pozadavek, ktery zacne export daneho typu
% - aktualne JSON a PDF
% - json vrati reprezentaci celeho materialu (resp. snimku)
% - pdf vygeneruje kazdy snimek do PDF
% - pro pdf se vyuziva puppeteer, ktery stejně jako kolaborace udělá obrázek stránky pomocí volání dotazu pro kazdý snímek
% - jelikoz stranky mohou mit ruzne velikosti, je nutne generovat po snimkach a potom je spojit do velkeho pdf

% - importovani: klient umi zpracovat a vytvořit materialu z JSON a markdown
% - markdown se na klientovi zparsuje pomoci knihovny marked, ktera umi vratit stromovou reprezentaci dat v textu
% - klient z toho přečte jednotive nadpisy a po nadpisech veskery obsah, ktery vloží na danou stranku s danym formatovanim
% - nadpis jedna je nazev materialu a titulni strany
% - umi zpracovat text, bold, italic, odkaz, listy
% - dovoluje to jednodusjei vytvorit kostru prezentace

\section{Rozšíření}

Platforma umožňuje přidávat nové funkcionality pomocí tzv. pluginů. 
Každý plugin má své jedinečné jméno a krátký popis, který vysvětluje jeho účel a hlavní funkce. 
Plugin může existovat v několika verzích, přičemž každá verze obsahuje manifest, kód pluginu a případně specifický kód pro editor.
Manifest obsahuje informace o tom, pro jakou verzi aplikace bylo rozšíření napsáno a různé další data, jako je například nastavení přístupu k doménám či jiným pravomocem.

Uživatelé, resp. vývojáři, mohou pluginy jednoduše přidávat přímo v aplikaci, pokud jsou přihlášeni, a také mají možnost nahrávat nové verze stávajících pluginů. 
K zajištění bezpečnosti a kvality je implementován systém schvalování, který ověřuje, zda pluginy splňují stanovená kritéria před jejich zveřejněním.

\subsection{Spouštění kódu}

Spouštění kódu pluginů probíhá bezpečně v prostředí QuickJS, jak je uvedeno v návrhu v kapitole \ref{text:navrh/plugins}. 
Kód pluginů má omezený přístup pouze k API editoru a obsahu stránky prostřednictvím definovaného rozhraní. 
Přístup k jakýmkoliv dalším zdrojům mimo tento rámec není možný ze zabezpečení knihovny QuickJS a jejich systému.

\subsection{Přístup k API}

Platforma poskytuje pluginům jasně definované globální API zahrnující funkce jako je:

\begin{description}
    \item[fetch] Který dovoluje volat požadavky přímo jako stránka editoru (tj. s CORS) na povolených doménách z manifestu.
    \item[cache] Který dovoluje rozšíření si pamatovat věci skrz spuštění.
    \item[plugin] Který dovoluje vědět, kdo je aktuálním spouštěčem skriptu.
    \item[language] Který dovoluje zjistit v jakém jazyce je aktuálně vykreslována stránka.
    \item[log] Který dovoluje vypisovat věci do konzole a logovacích souborů.
\end{description}

Dále mohou pluginy využívat API jednotlivých bloků, které umožňuje přístup k jejich vlastnostem a metodám.

Dále rozšíření, podle toho, kde jsou spuštěny, dovolují přistupovat ke konkrétním API přehrávače či editoru.

Editor API nabízí možnost číst bloky, přidávat nové bloky a nastavovat různé režimy a velikosti pracovního plátna. Podobně funguje i Player API, které rovněž umožňuje čtení a přidávání bloků spolu s nastavením režimů a velikostí.

\subsection{Zachycení se k událostem}

Každému rozšíření začíná životní cyklus voláním globální exportované funkce se jménem \texttt{initEditor} v spuštění v editoru, případně \texttt{initPlayer} v přehrávači.
V této metodě může rozšíření spouštět řadu věcí a již interagovat s API.
Základně v této metodě se budou programátoři rozšíření zejména připojovat k událostem, které způsobí to, že když daná událost nastane, tak se zavolá i příslušná funkce k této události od tohoto rozšíření. Ukázka zachycení k události a prvotního načtení je vyobrazena v kódu \ref{code:registraceUdalosti}.

Pro editor a přehrávač (ne nutně pro oba) existují následující události:

\begin{description}
    \item[pluginBlockRender] Tato událost se volá tehdy, když je blok typu \texttt{plugin} vykreslován. Událost se volá jen pro rozšíření, který blok vlastní. Volá se sporadicky, zejména jenom při prvotním načtení editoru či přehrávače. 
    \item[panelRegister] Tato událost se volá tehdy, když je uživatelské rozhraní připraveno získat informace o tom, jaký plugin požaduje jaké panely v rozhraní editoru. Na událost musí funkce vracet HTML, které se vykreslí v iframe. O bezpečnosti této metody viz kapitola \ref{text:vykreslovani}.
    \item[panelMessage] Událost se volá tehdy, když panel přiřazen tomuto rozšíření chce předat zprávu rozšíření. Předávaná data jsou vždy v textovém řetězci.
    \item[pluginBlockMessage] Tuto událost volá konkrétní blok v editoru či přehrávači právě tehdy, když chce předat zprávu rozšíření. Předávaná data jsou taktéž v textovém řetězci.
    \item[pluginBlockPropertyChange] Tato událost se volá tehdy, když v uživatelském rozhraní editoru uživatel změní konkrétnímu bloku vlastnost. Rozšíření pomocí parametrů ví jaká konkrétní vlastnost se změnila a na jakém bloku.
\end{description}

\begin{listing}[ht!]
\caption[Ukázkový zápis rozšíření a registrace na událost]{Ukázkový zápis rozšíření a registrace na událost, \textit{kód zkrácen a modifikován pro přehlednost}}\label{code:registraceUdalosti}
\begin{minted}{javascript}
export const onPanelMessage = (message) => {
  if (message !== "clicked") return;

  // Zde se provádí akce po kliknutí na tlačítko
  api.editor.addBlock({
    type: "text",
    // ... další vlastnosti bloku
  });
}

export const initEditor = function () {
  api.editor.on("panelMessage", onPanelMessage);
  api.editor.on("panelRegister", () => {
    // Zavolání např. api.fetch
    return `<button>Click me</button>
      <script>
      document.querySelector("button").addEventListener("click", 
        () => {
            window.parent.postMessage({
                target: "script", message: "clicked"
            }, "*");
        });
      </script>`;
  });
}
\end{minted}
\end{listing}


\subsection{Vykreslované bloky}

Pluginy mohou vytvářet vlastní bloky, které jsou vykreslovány při zobrazení materiálu. 
Samotné vykreslení bloku provádí platforma voláním příslušného rozšíření. 
Bloky a pluginy spolu mohou obousměrně komunikovat, což umožňuje dynamickou aktualizaci obsahu a interakci uživatelů s vykreslenými prvky.
Překreslování pomocí volání pluginu (tj. vykreslování HTML) je prováděno sporadicky, zejména jen v době, kdy se vykresluje poprvé či se upravují vlastnosti bloku.

\subsection{Panel}

Každý plugin může registrovat svůj vlastní panel, který se jednorázově vykreslí v uživatelském rozhraní. 
Tento panel umožňuje komunikaci mezi bloky a pluginy a slouží k výměně dat, například pro konfiguraci nastavení, vytváření nových bloků či editaci stávajících prvků. 
Ukázka komunikace mezi iframe pomocí API prohlížeče \texttt{postMessage} a tedy i v API aplikace je viditelný v kódu \ref{code:registraceUdalosti}.

% \section{Rozšíření}

% - plugin jmeno a popis
% - nekolik verzi, obshauje:
%   - manifest
%   - plugin kod
%   - editor kod
% - moznost pridavat pluginy v aplikaci pro prihlašeni a nahravat nove verze
% - system schvalovani\todo{neni}

% \subsection{Spouštění kódu}

% - viz navrh \ref{text:navrh/plugins}
% - tedy v JS, v emscriptu, zabezpečene
% - přistup k editoru a strance obecne pomoci api
% - mimo nema pristup, velmi omezene

% \subsection{Přístup k API}

% - globalni api:
%    - fetch
%    - cache
%    - plugin
%    - language
%    - log
% - bloky:
%    - bloky registruji api
%    - pristup vlastnosti jakymkoliv
% - editor api
%    - cteni bloku
%    - pridani bloku
%    - mody, velikosti platna
% - player api
%    - cteni bloku
%    - pridani bloku
%    - mody, velikosti platna

% \subsection{Vykreslované bloky}

% - plugin muze vytvorit blok, ktery vykresluje plugin
% - kdyz se ma blok vykreslit tak se vykresli pomoci volani rozsireni
% - vzajemna komunikace bloku a rozsireni

% \subsection{Panel}

% - kazdy plugin muze zaregistrovat panel
% - jednou vykresleni
% - vzajemna komunikace bloku a panelu
% - vymena dat, napr. pro nastaveni, vytvoreni bloku, editace a dalsi

\section{Hlavní webová stránka}\label{text:realizace/hlavniStranka}

Hlavní webová stránka byla vytvořena za účelem propagace aplikace.
Celý projekt a aplikace nese název \textbf{Materalist}.
Název vznikl spojením slov \textit{Material} a \textit{Specialist}, čímž odkazuje na zaměření aplikace na práci s různými specializovanými materiály.
Slouží jako výchozí bod pro návštěvníky, kteří se chtějí dozvědět více o aplikaci, jejích funkcích a možnostech využití. 
Stránka umožňuje přesměrování na samotnou aplikaci, přístup k dokumentaci a obsahuje přehled funkcionalit.

Důležitou součástí webové prezentace je porovnání s ostatními aplikacemi v daných oblastech. 
To pomáhá uživatelům lépe pochopit výhody a jedinečné vlastnosti aplikace. 
Kromě toho webová stránka představuje dostupné pluginy, které rozšiřují základní funkcionalitu aplikace.

Design webové stránky vychází z vizuálního stylu samotné aplikace (viz kapitola \ref{text:realizace/klient}). 
Stránka je responzivní a optimalizovaná pro různé typy zařízení.

Pro sjednocení vizuální identity bylo navrženo logo aplikace (viz obrázek \ref{fig:logo}), které symbolizuje kombinaci plátna a písmene \enquote{M}, což reflektuje jak materiálový aspekt, tak kreativní přístup k tvorbě obsahu.

\begin{figure}[ht!]
    \centering
    \includegraphics[width=0.4\textwidth]{media/05_realizace/logo.png}
    \caption{Logo aplikace Materalist}
    \label{fig:logo}
\end{figure}

Hlavní webová stránka byla tvořena taktéž ve webovém frameworku Vue, ze stejných důvodů jako hlavní aplikace.
Hlavním konceptem je velká jednostránková webová stránka, která obsahuje všechny důležité informace a odkazuje na dokumentaci a samostatnou aplikaci.

\section{Dokumentace}

- pomoci docosaurus
...

\section{Sestavení a nasazení aplikace}\label{text:realizace/nasazeni}

\section{Vytvořené bloky}\label{text:realizace/vytvoreneBloky}

Pro účely demonstrace schopností platformy a testování její flexibility byla implementována základní sada bloků.
Tyto bloky jsou přímo dostupné v rámci editoru a byly navrženy tak, aby pokrývaly široké spektrum typických potřeb při tvorbě vzdělávacích materiálů. 
Bloky reagují na nastavení v panelu vlastností a mění se podle toho, jaké možnosti autor obsahu zvolí. 
Některé bloky se po kliknutí přepnou do editačního režimu a umožní přímou úpravu svého obsahu, například textu nebo kódu. 

\subsection{Text}

Textový blok slouží pro vkládání formátovaného textu. 
Uživatel může upravit styl písma, jeho velikost a barvu, použít tučné, kurzívní, podtržené nebo přeškrtnuté písmo. 
Dále lze nastavit zarovnání textu (vlevo, vpravo, na střed i do bloku), font, horní a dolní index a také vytvářet seznamy. 

Po kliknutí na blok se aktivuje textový editor, ve kterém lze přímo označovat a upravovat text. 
Veškeré změny jsou zároveň reflektovány v panelu vlastností, odkud lze pohodlně ovlivnit celkové formátování. 
Vnitřně se text ukládá jako HTML, ale pro vykreslení se používá knihovna \texttt{sanitize-html}, která omezuje vykreslení jen na bezpečné a povolené značky a atributy.

\subsection{Obrázek}

Obrázkový blok umožňuje vkládání obrázků pomocí URL adresy. 
Je využíván především v obsahových menu, kde lze vybírat z fotobank, gifů nebo vlastních multimedií. 
Pro přesnější práci s obrázky je k dispozici funkce pro uzamčení poměru stran. 
Pokud je aktivní, obrázek se při změně velikosti bloku přizpůsobuje původnímu poměru. 

V opačném případě dochází k tzv. překrytí -- obrázek si ponechává původní rozměry a v případě menšího prostoru se jeho část ořízne.
Pokud se obrázek nepodaří načíst, editor zobrazí varování, přehrávač však zůstává tichý.

\subsection{Interaktivní oblast}

Tento blok je viditelný pouze v editoru, nikoli v přehrávači.
Slouží jako neviditelná vrstva, která umožňuje překrýt více prvků a zajistit, že se jejich interaktivita nebude vzájemně ovlivňovat.
Jde o užitečný nástroj především pro složitější kompozice.

\subsection{Mermaid diagram}

Pro tvorbu různých typů diagramů je využita knihovna \texttt{mermaid}. 
Umožňuje kreslit UML diagramy, grafy a další pomocné vizualizace. 
Uživatel může po kliknutí na blok upravit zdrojový kód diagramu. 
Mimo editační režim se automaticky vykresluje výsledný diagram.

Pokud kód obsahuje chybu, editor zobrazí varování a místo náhledu diagramu vykreslí hlášení.
V přehrávači se chybové bloky neobjevují. 
Vzhledem ke známým bezpečnostním rizikům (XSS zranitelnosti) a komplikacím při interakci byla implementace řešena pomocí \texttt{iframe}.

\subsection{Iframe okno}

Iframe blok slouží pro pokročilé uživatele, kteří chtějí do editoru vložit vlastní HTML, CSS nebo JavaScript. 
Blok umožňuje spustit libovolný kód v izolovaném prostředí a zobrazit jeho výsledek přímo v editoru.

Editace probíhá kliknutím na blok, kdy se otevře rozhraní pro úpravu kódu. 
Výstup se mimo editační režim vykreslí automaticky. 
Kvůli bezpečnostním rizikům a nemožnosti opustit iframe z vnitřního prostředí je nutné tento způsob používat obezřetně, viz kapitola \ref{text:anaylza/spousteniNeduveryhodnehoKodu}.

\subsection{Tvar}

Tvarové bloky poskytují jednoduchý způsob, jak do materiálu přidat vizuální strukturu. 
Obsahují základní předdefinované tvary jako obdélník, hvězda nebo elipsa. Uživatel může upravit barvu tvaru.

Některé tvary se dokážou přizpůsobit velikosti bloku -- typickým příkladem je šipka, která natahuje svůj střed dle aktuálních rozměrů.
Tyto bloky slouží jako doplňkový vizuální prvek, který zvyšuje čitelnost a srozumitelnost obsahu.



% \section{Vytvořené bloky}\label{text:realizace/vytvoreneBloky}

% - pro testování a ukázku schopnosti, ohebnosti systemu
% - základní bloky přímo v aplikaci
% - připraveno na leccos
% - bloky reaguji na vlastnosti v panelu vlastnosti
% - nektere bloky se pretransformuji/zmeni/dovoli editovat právě při kliku na vybrany blok (tj. treba kod ci text se zapisuje přímo do bloku v editoru)

% \subsection{Text}

% - dovoluje vkladat formatovany text
% - moznost menit barvu, velikost, bold, italics, underline, přeskrtnutí, zarovnani (vlevo, vpravo, doprostred, do bloku), font, suptext, subtext a taky lze vytvorit listy
% - po kliku na blok se otevre prave moznost oznacovat a psat text, ktery se poté v panelu vlastností upravuje
% - ciste teoreticky se uklada html, vykresluje se ale jen povolene mnozstvi tagů a atributu, na to se používá knihovna \texttt{sanitize-html}

% \subsection{Obrázek}

% - lze vkládat odkaz na obrázek
% - používají ho obsahové menu (foto/gif banky a vlastní uživatelské multimédia)
% - možnost zapnout tzv. zamknutí poměru stran, které nastaví možnost obrázek nastavit jen v původním poměru
% - v připradě vypnutného zapnutí se při zvětšování/zmenšování bloku se obrázek nastavuje na "překrytí", tj. obrázek je vždy v původním poměru, jen se ne vždy celý vejde (cropne se)
% - pokud se obrazek nepovede nacist, v editoru upozorneni, v prehravaci nic

% \subsection{Interaktivní oblast}

% - v editoru viditelna, v prehravaci nikoliv
% - dovoluje mit na sobe interaktivitu
% - hodi se napriklad na prekrytivi vice prvku, aby se zvlastne nekopirovala interakvita

% \subsection{Mermaid diagram}

% - vykresluje pomoci knihovny \texttt{mermaid} různé diagramy
% - mermaid dovoluje tvorit UML diagramy, grafy, matematicke grafy a různe další pomocné věci
% - editace pomoci kliku, tam se pise kód, mimo editaci se vykresluje
% - pokud je kod spatny, vykresli se chyba v editoru, v prehravaci nic
% - problem s klikanim, nutne pouzit znovu iframe, mermaid znamy s XSS chybami

% \subsection{Iframe okno}

% - dovoluje psat jakekoliv HTML (tedy i CSS, JS), ktere se spusti v oddelenem okne
% - editace pomoci kliku, tam pise kod, mimo editaci se vykresluje
% - hodi se pro zkusene lidi
% - nejde se z toho dostat, viz \ref{text:anaylza/spousteniNeduveryhodnehoKodu}

% \subsection{Tvar}

% - pouzivani preddefinovanych tvaru
% - napr. obdelnik, hvezda, elipsa
% - moznost nastavit barvu
% - nektere specialni, daji se natahovat a oni se adaptuji, jako napr. sipka - prostredek se natahne dle velikosti

\section{Vytvořené rozšíření}\label{text:realizace/vytvoreneRozsireni}

Součástí návrhu platformy byla i možnost komunitního rozšiřování funkcionality prostřednictvím pluginů. 
Tato sekce představuje několik ukázkových rozšíření, která byla v rámci vývoje vytvořena. 
Slouží jako demonstrace možností systému, jeho flexibility a využití připraveného API. 
Rozšíření vytvořena (či testována) i dalšími uživateli, kteří se na vývoji platformy nepodíleli, jsou popsány v kapitole \ref{text:testovani}.
To umožnilo získat nezávislou zpětnou vazbu, podrobněji popsanou v kapitole o testování. Všechna rozšíření jsou dostupná v přiložené aplikaci a taktéž jako příloha práce.
Rozšíření jsou dostupná v příloze ve složce SLOŽKA\todo{CESTA K PLUGINŮM}.

\subsection{Centrist}

Centrist je jednoduché rozšíření, které slouží jako pomocník při práci v editoru.
Jeho funkcionalita se omezuje pouze na editor a nijak nezasahuje do přehrávače (neobsahuje žádný vykonávaný kód).
Rozšíření vytváří uživatelské rozhraní pro úpravu zarovnání jednotlivých bloků.

Po aktivaci se v editoru zobrazí postranní panel, který umožňuje upravovat pozici vybraných bloků. 
Uživatel může snadno provést zarovnání do středu plátna, rozložit více bloků rovnoměrně, nebo je k sobě přiblížit v horizontálním či vertikálním směru. 
Toto rozšíření je ukázkou, jak lze bez většího zásahu do systému vytvořit užitečný nástroj, který zlepšuje komfort práce s obsahem.

\subsection{Dnešní svátek}

Rozšíření \enquote{Dnešní svátek} poskytuje možnost vložit do materiálu jednoduchý prvek zobrazující svátek aktuálního dne. 
Data jsou získávána z veřejně dostupného API služby \texttt{svatkyapi.cz}.

Aby se předešlo opakovanému volání externí služby, využívá se v rámci rozšíření jednoduchá cache. 
Po načtení dat je výsledek uložen na dobu platnosti, čímž se výrazně snižuje zatížení rozhraní a eliminuje se problém s případným omezením počtu požadavků (rate limiting).
V manifestu rozšíření je zároveň explicitně uvedeno, že je povoleno připojení na danou doménu API, aby nebyly porušeny bezpečnostní zásady platformy.

\subsection{Fluid background}

Fluid background je vizuálně výrazné a technicky náročnější rozšíření, které demonstruje pokročilé možnosti práce s vykreslováním pomocí WebGL.
Uživatel může pomocí panelu v editoru upravovat různé parametry shaderu, jako jsou barvy, amplitudy, rychlosti pohybu a další vizuální efekty.

Tato ukázka slouží jako příklad toho, jakým způsobem lze vytvářet složitější a zároveň efektivní vizuální bloky, které mohou obohatit prezentaci nebo jiný výukový materiál. 
Současně bylo potřeba řešit i technické aspekty, jako je správné překreslování bloku při změně parametrů, protože každá úprava musí vést k aktualizaci vykreslení.

Rozšíření také ukazuje využití API editoru a jeho schopnost reagovat na změny uživatelského vstupu v reálném čase.

% \section{Vytvořené rozšíření}\label{text:realizace/vytvoreneRozsireni}

% - ukázka systému, vytvořeny nějaká rozšíření
% - ukázka a testování systému
% - více v testování od lidi, co platformu nevyvijeli pro lepši zhodnoceni
% - všechny pluginy jsou k dispozici v nahrané aplikaci a v příloze \todo{CESTA K PLUGINŮM}

% \subsection{Centrist}

% - ukázka pouze modifikace v editoru (pomocník), nedělá nic v přehrávači, nemá žádný kód
% - dovoluje zarovnávat na editoru
% - panel ve kterém lze modifikovat označené bloky
% - rozložení do prostřed, rozdělit rovnoměrně, přiblížit k sobě v obou osách

% \subsection{Dnešní svátek}

% - dovoluje vkládat jednoduché pole s dnešním svátkem
% - volání externí služby - svatkyapi.cz
% - využití cache pro ukládání svátku kvůli omezení API (rate limiting)
% - manifest pro dovolení fetch na dané doméně API

% \subsection{Fluid background}

% - komplexní vykreslování shaderu webgl
% - mnoho parametrů přímo v editoru (ukazka API bloku)
% - nutne resit prekreslovani bloku

% \subsection{Page numberer}\todo{Actually ještě není vytvořené}

% - číslování slidů

\section{Ukázkové materiály}\label{text:realizace/vytvoreneMaterialy}

- ukázka systému, možnost vytvořit komplexní prezentace do jdou v jiných aplikacích
- více v testování